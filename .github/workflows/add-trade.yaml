name: ðŸš€ Add Trade Entry

on:
  workflow_dispatch:
    inputs:
      pair:
        description: 'Trading pair (e.g., BTC/USDT)'
        required: true
        type: string
      datetime:
        description: 'Date and time (YYYY-MM-DD HH:mm)'
        required: true
        type: string
      bias:
        description: 'Bias'
        required: true
        type: choice
        options:
          - 'Bullish ðŸ“ˆ'
          - 'Bearish ðŸ“‰'
      liquidity:
        description: 'Liquidity'
        required: true
        type: string
      poi:
        description: 'Point of Interest'
        required: true
        type: string
      outcome:
        description: 'Outcome'
        required: true
        type: choice
        options:
          - Win
          - Loss
          - Break-even
      pl:
        description: 'P/L'
        required: true
        type: string
      notes:
        description: 'Notes'
        required: false
        type: string
      confirm:
        description: 'Please confirm all data is correct (checkbox)'
        required: true
        type: boolean

jobs:
  add_trade:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repo
        uses: actions/checkout@v4

      - name: Verify confirmation
        if: ${{ inputs.confirm != 'true' }}
        run: |
          echo "You must confirm all data is correct by checking the confirm box."
          exit 1

      - name: Prepare new entry YAML
        id: prep_yaml
        run: |
          # Strip emojis from bias input for data consistency
          BIAS="${{ inputs.bias }}"
          BIAS="${BIAS//ðŸ“ˆ/}"
          BIAS="${BIAS//ðŸ“‰/}"
          BIAS="$(echo $BIAS | xargs)"  # trim whitespace

          cat <<EOF > new_entry.yaml
          - pair: ${{ inputs.pair }}
            datetime: "${{ inputs.datetime }}"
            bias: $BIAS
            liquidity: "${{ inputs.liquidity }}"
            poi: "${{ inputs.poi }}"
            outcome: "${{ inputs.outcome }}"
            pl: "${{ inputs.pl }}"
            notes: "${{ inputs.notes }}"
          EOF

      - name: Append to data.yaml
        run: |
          echo "" >> data.yaml  # ensure newline at EOF before appending
          cat new_entry.yaml >> data.yaml

      - name: Commit and push changes
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add data.yaml
          git commit -m "Add new trade entry from workflow_dispatch"
          git push
